uniqueName: demo-wf1
actors:
  Everyone: # string actor name
    type: NoAuthorized
    descriptions: Access this instance without authorized
  userInRegionAC: # string actor name
    type: UserRoles
    descriptions: all user has role=user can create this request 
    roleNames:
      - user-region-A
      - user-region-C
  userHasId123:
    type: SpecificUsers
    description: Some special User can do, listed by userId bellow
    userIds:
      - 1
      - 2
      - 3
  documentAuthor:
    type: FormBased
    descriptions: User crate has right on this documents
    expression: form.requestId==$currentUser #$ is the buit in 
    runtime: jmespath
states:
  - uniqueName: draft
    type: begin
    actors:
      - ${actors:userInRegionAC}
      - ${actors:userHasId123}
    controls:
      - type: textbox
        uniqueName: requestTitle
        displayText: Request Title
        require: false
      - type: textbox
        uniqueName: Description
        displayText: Description
        require: false
      - type: textbox
        formuniqueName: reviewerL1
        displayText: Choose your reviewer
        require: true
    commands:
      - uniqueName: save
        displayText: Save
        nextState: null
        actors:
        - ${actors:userInRegionAC}
      - uniqueName: submit
        displayText: Submit
        nextState: lavel1-reviewing
        condition: form
        actors:
          operator: AND
          list:
          - ${actors:userInRegionAC}
          - ${actors:documentAuthor}
        tasks:
          - uniqueName: sendEmail
            type: sendEmail
            descriptions: Send email to edit level1-reviewer
            emailTemplete: EM01
          - uniqueName: sendEmail
            type: sendEmail
            descriptions: Send email to edit document owner
            emailTemplate: EM02
  - uniqueName: level1-reviewing
    actors: form.reviewerL1
    controls:
      - type: textbox
        uniqueName: requestTitle
        displayText: Request Title
        readonly: true
      - type: textbox
        uniqueName: Description
        displayText: Description
        readonly: true
      - type: textbox
        formuniqueName: reviewerL1
        displayText: Selected Reviewer
        readonly: true
    commands:
      - uniqueName: approve
        displayText: Approve
        nextState: end
        tasks:
          - uniqueName: sendEmail
            type: sendEmail
            descriptions: Send email to author
            emailTemplete: EM03
      - uniqueName: approve-to-l2
        displayText: Approve
        nextState: level2-reviewing
        allowCommand: Check!CheckCon1
        tasks:
          - uniqueName: sendEmail
            type: sendEmail
            descriptions: Send email to author
            emailTemplete: EM03
          - uniqueName: task1_demo
            task: Task!Task1
            runAt: beforeExecution
      - uniqueName: reject
        displayText: Reject
        nextState: draft
        tasks:
          - uniqueName: sendEmail
            type: sendEmail
            descriptions: Send email to author
            emailTemplete: EM04
  - uniqueName: level2-reviewing
    actors: form.reviewerL2
    controls:
      - type: textbox
        uniqueName: requestTitle
        displayText: Request Title
        readonly: true
      - type: textbox
        uniqueName: Description
        displayText: Description
        readonly: true
      - type: textbox
        formuniqueName: reviewerL1
        displayText: L1 Reviewer
        readonly: true
      - type: textbox
        formuniqueName: l1Feeback
        displayText: L1 Feedback
        readonly: true
    commands:
  - uniqueName: end
    type: end
    actors: reviewerL1, author
    controls:
      - type: textbox
        uniqueName: requestTitle
        displayText: Request Title
        readonly: true
      - type: textbox
        uniqueName: Description
        displayText: Description
        readonly: true
      - type: textbox
        formuniqueName: reviewerL1
        displayText: Reviewer
        readonly: true